unit uFrmCadastroModelo;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, uFrmCadastro, Vcl.StdCtrls, Vcl.Buttons, uModelos, uControllerModelos,
  uFrmConsultaMarca;

type
  TFrmCadastroModelo = class(TFrmCadastro)
    Label1: TLabel;
    edtmodelo: TEdit;
    Label3: TLabel;
    Label4: TLabel;
    Label8: TLabel;
    edtcodmarca: TEdit;
    edtmarca: TEdit;
    btnpesquisar: TButton;
    Label2: TLabel;
    procedure btnpesquisarClick(Sender: TObject);
    procedure edtcodmarcaExit(Sender: TObject);
  private
    { Private declarations }
  protected
    ummodelo : Modelos;
    umactrlmodelo : ControllerModelos;
    umfrmconsultamarca : TFrmConsultaMarca;
  public
    procedure ConhecaObj (pObj : TObject; pctrl : TObject);  Override;
    procedure Salvar;                       Override;
    procedure Sair;                         Override;
    procedure CarregaEdt;                   Override;
    procedure LimpaEdt;                     Override;
    procedure BloqueiaEdt;                  Override;
    procedure DesbloqueiaEdt;               Override;
    procedure SetFrmConsulta (pObj : TObject);

  end;

var
  FrmCadastroModelo: TFrmCadastroModelo;

implementation

{$R *.dfm}

{ TFrmCadastroModelo }

procedure TFrmCadastroModelo.BloqueiaEdt;
begin
  self.edtmarca.Enabled := false;
  self.edtmodelo.Enabled := false;
  self.edtcodmarca.Enabled := false;
end;

procedure TFrmCadastroModelo.btnpesquisarClick(Sender: TObject);
var mbotao : string;
begin
  inherited;
  mbotao := umfrmconsultamarca.btnSair.Caption;
  umfrmconsultamarca.btnSair.Caption := 'SELECIONAR';
  umfrmconsultamarca.conhecaObj(ummodelo.getumamarca, umactrlmodelo.getctrlmarca);
  umfrmconsultamarca.ShowModal;

  umfrmconsultamarca.btnSair.Caption := mbotao;
  self.edtcodmarca.Text := inttostr(ummodelo.getumamarca.getcodigo);
  self.edtmarca.Text := ummodelo.getumamarca.getmarca;
end;

procedure TFrmCadastroModelo.CarregaEdt;
begin
  self.edtmodelo.Text := inttostr(ummodelo.getcodigo);
  self.edtcodmarca.Text := inttostr(ummodelo.getumamarca.getcodigo);
  self.edtmarca.Text := ummodelo.getumamarca.getmarca;
end;

procedure TFrmCadastroModelo.ConhecaObj(pObj, pctrl: TObject);
begin
  inherited;
  ummodelo             := Modelos (pObj);
  umactrlmodelo         := ControllerModelos (pctrl);
  self.edtCodigo.Text   := inttostr(self.ummodelo.getCodigo);
end;

procedure TFrmCadastroModelo.DesbloqueiaEdt;
begin
  self.edtmarca.Enabled := true;
  self.edtmodelo.Enabled := true;
  self.edtcodmarca.Enabled := true;
end;

procedure TFrmCadastroModelo.edtcodmarcaExit(Sender: TObject);
var mMSG : string;
begin
  inherited;
    mMSG := umactrlmodelo.getctrlmarca.Pesquisar(self.edtcodmarca.Text);
    umactrlmodelo.getctrlmarca.Carregar(ummodelo.getumamarca);
    self.edtcodmarca.Text := inttostr(ummodelo.getumamarca.getcodigo);
    self.edtmarca.Text := ummodelo.getumamarca.getmarca;
    if self.edtcodmarca.Text = 0 then
    begin
      ShowMessage('Marca não encontrada');
      self.edtcodmarca.SetFocus;
    end;
end;

procedure TFrmCadastroModelo.LimpaEdt;
begin
  self.edtmodelo.Clear;
  self.edtcodmarca.Clear;
  self.edtmarca.Clear;
end;

procedure TFrmCadastroModelo.Sair;
begin
  inherited;
end;

procedure TFrmCadastroModelo.Salvar;
begin
  inherited;
  if self.btnSalvar.Caption = '&Excluir' then
  begin
    If Application.MessageBox('Confirma Exclusão ?','Cuidado !!!',MB_YESNO + MB_ICONQUESTION + MB_DEFBUTTON2) = IDYES Then
    begin
      self.umactrlmodelo.Excluir(ummodelo);
      ShowMessage('Excluido com Sucesso!!!');
      self.sair;
    end;
  end
  else
  begin
     if (self.edtmodelo.Text = '')then
     begin
        ShowMessage('Campo Modelo precisa ser preenchido!!!');
        self.edtmodelo.SetFocus;
     end
     else if (self.edtmarca.Text = '') then
     begin
        ShowMessage('Campo Marca precisa ser preenchido!!!');
        self.edtmarca.SetFocus
     end
     else
      ummodelo.setcodigo(strtoint(self.edtcodigo.Text));
      ummodelo.setmodelo(self.edtmodelo.Text);
      ummodelo.getumamarca.setcodigo(strtoint(self.edtcodmarca.Text));
      ummodelo.getumamarca.setmarca(self.edtmarca.Text);
      umactrlmodelo.Salvar(ummodelo.clone);
      ShowMessage('Salvo com Sucesso!!!');
      self.sair;
     end;
end;

procedure TFrmCadastroModelo.SetFrmConsulta(pObj: TObject);
begin
  umFrmConsultaMarca := TFrmConsultaMarca (pObj);
end;

end.
